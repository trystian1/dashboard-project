"use strict";angular.module("dashboardProjectApp",["ngAnimate","ui.router"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/keymetrics"),$stateProvider.state("geo",{url:"/geo",templateUrl:"views/geo.html",controller:"GeoCtrl as geo"}).state("keymetrics",{url:"/keymetrics",templateUrl:"views/key-metrics.html",controller:"KeymetricsCtrl as keymetric"}).state("issues",{url:"/issues",templateUrl:"views/issues.html",controller:"IssuesCtrl as issues"})}]),angular.module("dashboardProjectApp").service("geoService",function($http){this.getGeoData=function(){return $http({method:"GET",url:"api/companies.json"})}}),angular.module("dashboardProjectApp").service("metricsService",function($http){this.getQuaterSales=function(){return $http({method:"GET",url:"api/sales.json"})},this.getIssues=function(){return $http({method:"GET",url:"api/MOCK_DATA.csv"})},this.convertCSV=function(csv){var lines=csv.split("\n"),array=[];return lines.forEach(function(line){var lineInfo=line.split(",");console.log(lineInfo[5]);var object={id:lineInfo[0],firstName:lineInfo[1],lastName:lineInfo[2],email:lineInfo[3],issue:lineInfo[5]&&lineInfo[5].length>40?lineInfo[5].substring(0,40):lineInfo[5],opened:lineInfo[6],closed:lineInfo[7],status:lineInfo[8]};array.push(object)}),array},this.getRandomIssue=function(issues){return issues[Math.floor(Math.random()*issues.length)+1]},this.getLatestSale=function(){var sale=Math.floor(4e3*Math.random())+1;return[{sales:sale.toString(),registered:new Date}]},this.parseData=function(data,dateValue){var yearData={Q1:[],Q2:[],Q3:[],Q4:[]};return data.forEach(function(value){var month=new Date(value[dateValue]).getMonth();switch(month){case 0:case 1:case 2:yearData.Q1.push(value);break;case 3:case 4:case 5:yearData.Q2.push(value);break;case 6:case 7:case 8:yearData.Q3.push(value);break;case 9:case 10:case 11:yearData.Q4.push(value)}}),yearData},this.getTotalQuarterResult=function(data){var totalResult=0;return data.forEach(function(data){var salesData=data.sales.replace(",","");totalResult+=parseFloat(salesData.replace("$",""),10)}),totalResult.toFixed(2)},this.getPositionOnGraph=function(totalResult){var precentage=(totalResult/1e6).toFixed(2);return 373-(373*precentage).toFixed(0)}}),angular.module("dashboardProjectApp").controller("GeoCtrl",["geoService",function(geoService){var _this=this;geoService.getGeoData().then(function(response){_this.countries=response.data},function(response){}),this.onClickCountry=function(event){_this.countryName=event.currentTarget.attributes.title.value,this.selectedCountry=_this.countries.find(function(item){return item.country===_this.countryName})}}]),angular.module("dashboardProjectApp").controller("IssuesCtrl",["metricsService",function(metricsService){this.orderProp="opened";var _this=this;metricsService.getIssues().then(function(response){_this.totalIssues=metricsService.convertCSV(response.data),_this.loadedItems=101,_this.issues=_this.totalIssues.slice(1,101),console.log(_this.issues)},function(response){}),this.sortBy=function(prop){console.log(prop),this.orderProp=prop}}]),angular.module("dashboardProjectApp").controller("KeymetricsCtrl",["metricsService","$interval",function(metricsService,$interval){var _this=this;this.q1TotalSales=0,this.q2TotalSales=0,this.q3TotalSales=0,this.q4TotalSales=0,this.issuesQ1Length=0,this.issuesQ2Length=0,this.issuesQ3Length=0,this.issuesQ4Length=0,metricsService.getQuaterSales().then(function(response){_this.yearData=metricsService.parseData(response.data,"registered"),_this.parseDataIntoQuarters(_this.yearData)},function(response){}),metricsService.getIssues().then(function(response){_this.issues=metricsService.convertCSV(response.data),_this.randomIssue=metricsService.getRandomIssue(_this.issues),_this.startIssueInterval(_this.issues),_this.issueYearData=metricsService.parseData(_this.issues,"opened"),_this.parseIssuesIntoGraph(_this.issueYearData)},function(response){}),this.salesInterval=$interval(function(){var latestSale=metricsService.getLatestSale();metricsService.parseData(latestSale,"registered");_this.recentSale=latestSale[0],_this.yearData.Q4.push(latestSale[0]),_this.parseDataIntoQuarters(_this.yearData)},1e3),this.startIssueInterval=function(issues){$interval(function(){_this.randomIssue=metricsService.getRandomIssue(issues),_this.issuesQ4Length+=1},4e3)},this.parseDataIntoQuarters=function(data){this.q1TotalSales=metricsService.getTotalQuarterResult(data.Q1),this.q2TotalSales=metricsService.getTotalQuarterResult(data.Q2),this.q3TotalSales=metricsService.getTotalQuarterResult(data.Q3),this.q4TotalSales=metricsService.getTotalQuarterResult(data.Q4),this.progress=this.q4TotalSales/1e6*100,this.progress>100&&$interval.cancel(this.salesInterval),this.q1Position=metricsService.getPositionOnGraph(this.q1TotalSales),this.q2Position=metricsService.getPositionOnGraph(this.q2TotalSales),this.q3Position=metricsService.getPositionOnGraph(this.q3TotalSales),this.q4Position=metricsService.getPositionOnGraph(this.q4TotalSales)},this.parseIssuesIntoGraph=function(issues){this.issuesQ1Length=issues.Q1.length,this.issuesQ2Length=issues.Q2.length,this.issuesQ3Length=issues.Q3.length,this.issuesQ4Length=issues.Q4.length}}]),angular.module("dashboardProjectApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]});